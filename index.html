<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>阿拉伯语单词学习卡</title>
  <style>
    :root {
      --primary-color: #2563eb;
      --secondary-color: #059669;
      --error-color: #dc2626;
      --text-color: #1f2937;
      --bg-color: #f3f4f6;
      --card-color: #ffffff;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      width: 100%;
      max-width: 600px;
      background-color: var(--card-color);
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 2rem;
      margin-top: 2rem;
    }

    h1 {
      color: var(--primary-color);
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .word-card {
      min-height: 250px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: #f8fafc;
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1.5rem 0;
      border: 1px solid #e2e8f0;
      transition: all 0.3s ease;
    }

    .word-display {
      font-size: 3rem;
      font-weight: bold;
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      direction: rtl;
      font-family: 'Noto Sans Arabic', sans-serif;
    }

    .translation {
      font-size: 1.2rem;
      margin: 0.5rem 0;
      color: var(--text-color);
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
    }

    button {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .primary-btn {
      background-color: var(--primary-color);
      color: white;
    }

    .primary-btn:hover {
      background-color: #1d4ed8;
      transform: translateY(-2px);
    }

    .secondary-btn {
      background-color: var(--secondary-color);
      color: white;
    }

    .secondary-btn:hover {
      background-color: #047857;
      transform: translateY(-2px);
    }

    button:disabled {
      background-color: #9ca3af;
      cursor: not-allowed;
      transform: none !important;
    }

    .loading {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid rgba(37, 99, 235, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error-container {
      margin-top: 1rem;
      padding: 1rem;
      background-color: #fee2e2;
      border-radius: 6px;
      color: var(--error-color);
      text-align: center;
    }

    .stats {
      margin-top: 1.5rem;
      text-align: center;
      font-size: 0.9rem;
      color: #6b7280;
    }

    .hidden {
      display: none;
    }

    /* 响应式设计 */
    @media (max-width: 640px) {
      .container {
        padding: 1.5rem;
      }
      
      .word-display {
        font-size: 2.5rem;
      }
    }
  </style>
  <!-- 加载阿拉伯字体 -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1>阿拉伯语单词学习卡</h1>
    
    <div class="word-card" id="wordCard">
      <div class="welcome-message">
        <p>点击下方按钮开始学习阿拉伯语单词</p>
        <div class="example">
          <div class="word-display">بيت</div>
          <div class="translation">中文: 房子</div>
          <div class="translation">English: house</div>
        </div>
      </div>
    </div>
    
    <div class="controls">
      <button class="primary-btn" id="nextBtn" onclick="loadWord()">
        <span id="nextBtnText">下一张</span>
      </button>
      <button class="secondary-btn" id="speakBtn" onclick="speakWord()" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
          <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
          <line x1="12" y1="19" x2="12" y2="23"></line>
          <line x1="8" y1="23" x2="16" y2="23"></line>
        </svg>
        朗读
      </button>
    </div>
    
    <div id="errorContainer" class="error-container hidden"></div>
    
    <div class="stats">
      已学习 <span id="wordCount">0</span> 个单词
    </div>
  </div>

  <script>
    // 状态管理
    let currentWord = null;
    let wordCounter = 0;
    let isLoading = false;
    
    // DOM元素
    const wordCard = document.getElementById("wordCard");
    const nextBtn = document.getElementById("nextBtn");
    const speakBtn = document.getElementById("speakBtn");
    const errorContainer = document.getElementById("errorContainer");
    const wordCountElement = document.getElementById("wordCount");
    const nextBtnText = document.getElementById("nextBtnText");
    
    // 主功能：加载单词
    async function loadWord() {
      if (isLoading) return;
      
      // 设置加载状态
      isLoading = true;
      nextBtn.disabled = true;
      nextBtnText.innerHTML = `<span class="loading"></span> 加载中`;
      speakBtn.disabled = true;
      hideError();
      
      // 清空当前卡片或显示加载状态
      wordCard.innerHTML = `
        <div style="text-align: center;">
          <div class="loading" style="margin: 0 auto;"></div>
          <p>正在获取单词...</p>
        </div>
      `;
      
      try {
        // 1. 发起API请求
        const startTime = performance.now();
        const response = await fetch("https://arabic-proxy.head-6c9.workers.dev");
        
        // 2. 检查网络响应
        if (!response.ok) {
          throw new Error(`请求失败: ${response.status} ${response.statusText}`);
        }
        
        // 3. 解析JSON数据
        const data = await response.json();
        console.log("API响应:", data);
        
        // 4. 验证数据格式
        let wordData;
        if (data.word && data.zh && data.en) {
          // 格式1: 结构化数据
          wordData = {
            arabic: data.word,
            zh: data.zh,
            en: data.en
          };
        } else if (data.text) {
          // 格式2: 文本解析
          const match = data.text.match(/word:\s*(.*?)\s*,\s*zh:\s*(.*?)\s*,\s*en:\s*(.*)/);
          if (!match) throw new Error("无法解析API返回的文本格式");
          wordData = {
            arabic: match[1].trim(),
            zh: match[2].trim(),
            en: match[3].trim()
          };
        } else {
          throw new Error("API返回了无法识别的格式");
        }
        
        // 5. 更新UI
        renderWordCard(wordData);
        currentWord = wordData.arabic;
        wordCounter++;
        wordCountElement.textContent = wordCounter;
        
        // 6. 启用朗读按钮
        speakBtn.disabled = false;
        
        // 记录性能
        const loadTime = ((performance.now() - startTime) / 1000).toFixed(2);
        console.log(`单词加载耗时: ${loadTime}秒`);
        
      } catch (error) {
        console.error("加载单词失败:", error);
        showError(error.message);
        useFallbackData();
      } finally {
        // 重置加载状态
        isLoading = false;
        nextBtn.disabled = false;
        nextBtnText.textContent = "下一张";
      }
    }
    
    // 渲染单词卡片
    function renderWordCard(wordData) {
      wordCard.innerHTML = `
        <div class="word-display">${wordData.arabic}</div>
        <div class="translation">中文: ${wordData.zh}</div>
        <div class="translation">English: ${wordData.en}</div>
      `;
    }
    
    // 显示错误信息
    function showError(message) {
      errorContainer.innerHTML = `
        <p>❌ ${formatErrorMessage(message)}</p>
        <button onclick="loadWord()" class="primary-btn" style="margin-top: 0.5rem;">重试</button>
      `;
      errorContainer.classList.remove("hidden");
    }
    
    // 隐藏错误信息
    function hideError() {
      errorContainer.classList.add("hidden");
    }
    
    // 格式化错误信息
    function formatErrorMessage(error) {
      const errors = {
        "Failed to fetch": "网络连接失败，请检查您的网络",
        "Network request failed": "网络请求失败",
        "无法解析": "服务器返回的数据格式不正确"
      };
      return errors[error] || error;
    }
    
    // 使用备用数据
    function useFallbackData() {
      const fallbackWords = [
        { arabic: "كتاب", zh: "书", en: "book" },
        { arabic: "مدرسة", zh: "学校", en: "school" },
        { arabic: "سيارة", zh: "汽车", en: "car" },
        { arabic: "تفاحة", zh: "苹果", en: "apple" },
        { arabic: "شمس", zh: "太阳", en: "sun" }
      ];
      
      const randomWord = fallbackWords[Math.floor(Math.random() * fallbackWords.length)];
      renderWordCard(randomWord);
      currentWord = randomWord.arabic;
      wordCounter++;
      wordCountElement.textContent = wordCounter;
      speakBtn.disabled = false;
    }
    
    // 朗读单词
    function speakWord() {
      if (!currentWord) return;
      
      try {
        if (!window.speechSynthesis) {
          throw new Error("您的浏览器不支持语音合成");
        }
        
        const utterance = new SpeechSynthesisUtterance(currentWord);
        utterance.lang = 'ar-SA'; // 阿拉伯语(沙特)
        utterance.rate = 0.8;
        
        // 停止当前正在播放的语音
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utterance);
        
      } catch (error) {
        showError(`朗读失败: ${error.message}`);
      }
    }
    
    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      // 检查语音合成支持
      if (!window.speechSynthesis) {
        speakBtn.style.display = 'none';
      }
      
      // 首次加载一个单词
      // loadWord(); // 可以选择自动加载或等待用户点击
    });
  </script>
</body>
</html>
