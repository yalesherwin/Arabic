<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>阿拉伯语单词学习课堂 - CHINACNU STEEL</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --main: #2541b2;
      --accent: #e9eafd;
      --btn: #f7b801;
      --card: #fff;
      --shadow: 0 6px 32px 0 rgba(44,62,80,.13);
      --radius: 22px;
    }
    body {
      min-height: 100vh;
      margin: 0;
      font-family: 'Roboto', 'Microsoft YaHei', Arial, sans-serif;
      background: linear-gradient(135deg, #e9eafd 0%, #f2f7fb 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
    }
    .header {
      margin-top: 32px;
      text-align: center;
      margin-bottom: 18px;
    }
    .header img {
      height: 48px;
      margin-bottom: 10px;
    }
    .header h1 {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      font-size: 2.1rem;
      font-weight: 700;
      color: var(--main);
      letter-spacing: 1px;
      line-height: 1.15;
    }
    .header .sub {
      color: #68708c;
      font-size: 1rem;
      margin-top: 8px;
      letter-spacing: 0.5px;
    }
    .container {
      background: var(--card);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 40px 26px 32px;
      max-width: 400px;
      width: 96vw;
      margin: 0 auto 20px;
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: fadeIn 1s cubic-bezier(.4,0,.2,1);
    }
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
    .word-card {
      width: 100%;
      min-height: 155px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 18px 8px 10px;
      margin-bottom: 18px;
      border-radius: 16px;
      background: linear-gradient(97deg, #e3e7f8 50%, #fff 100%);
      box-shadow: 0 2px 12px 0 rgba(44,62,80,.04);
      transition: box-shadow .3s;
    }
    .word-display {
      font-size: 2.4em;
      font-family: 'Montserrat', serif;
      font-weight: 700;
      color: var(--main);
      margin-bottom: 8px;
      letter-spacing: 2px;
      word-break: break-all;
    }
    .translation {
      font-size: 1.09em;
      color: #444;
      margin-bottom: 2px;
      text-align: center;
      letter-spacing: 0.2px;
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 14px;
      margin: 8px 0 2px;
    }
    .primary-btn, .secondary-btn {
      border: none;
      border-radius: 32px;
      padding: 0.66em 2.4em;
      font-size: 1.05em;
      font-weight: 600;
      font-family: 'Montserrat', 'Roboto', sans-serif;
      box-shadow: 0 2px 8px 0 rgba(39,50,90,.09);
      cursor: pointer;
      outline: none;
      margin-bottom: 0;
      transition: background .18s, box-shadow .16s;
      min-width: 90px;
    }
    .primary-btn {
      background: var(--main);
      color: #fff;
    }
    .primary-btn:disabled {
      background: #9db4e2;
      color: #f3f3f3;
      cursor: not-allowed;
    }
    .secondary-btn {
      background: #f4f5fb;
      color: #2541b2;
      border: 1px solid #c2cbdf;
    }
    .secondary-btn:disabled {
      background: #f1f1f7;
      color: #b1b4ca;
      border-color: #e9eafd;
    }
    .stats {
      font-size: 1em;
      color: #546c8c;
      background: #f4f7fc;
      border-radius: 10px;
      margin: 16px 0 0 0;
      padding: 8px 18px;
      box-shadow: 0 1px 8px rgba(180,190,230,0.07);
      letter-spacing: .2px;
    }
    .error-container {
      background: #fdeaea;
      color: #cf1124;
      border-radius: 10px;
      margin: 13px 0 0;
      padding: 13px 16px 7px;
      font-size: 1em;
      box-shadow: 0 1px 7px rgba(222,72,72,0.05);
      animation: shake 0.28s;
    }
    @keyframes shake {
      0% { transform: translateX(0); }
      24% { transform: translateX(-6px); }
      48% { transform: translateX(6px); }
      72% { transform: translateX(-4px);}
      100% { transform: translateX(0);}
    }
    .error-container.hidden { display: none; }
    .loading {
      width: 22px;
      height: 22px;
      border: 3px solid #e5e8f4;
      border-top: 3px solid #2541b2;
      border-radius: 50%;
      display: inline-block;
      animation: spin 1s linear infinite;
      vertical-align: middle;
    }
    @keyframes spin { to{transform: rotate(360deg);} }
    .welcome-message {
      text-align: center;
      color: #68708c;
      font-size: 1.12em;
      margin: 0 0 8px 0;
    }
    .welcome-message .example {
      margin-top: 12px;
      background: #f6f8fb;
      padding: 15px 10px 8px;
      border-radius: 13px;
      display: inline-block;
      box-shadow: 0 1px 6px 0 rgba(42,67,124,0.04);
    }
    @media (max-width:600px) {
      .container { padding: 22px 3vw 16px; max-width:98vw;}
      .word-display {font-size:2em;}
      .header {margin-top:16px;}
      .header h1 {font-size:1.3rem;}
    }
    /* 背景装饰 - 企业感 */
    .bg-circle {
      position: absolute;
      border-radius: 50%;
      filter: blur(1.7px);
      opacity: .14;
      z-index: 0;
    }
    .bg-circle1 {
      width: 340px; height: 340px;
      left: -110px; top: -90px;
      background: linear-gradient(110deg, #2541b2 0%, #41b7fc 100%);
    }
    .bg-circle2 {
      width: 230px; height: 230px;
      right: -60px; bottom: -60px;
      background: linear-gradient(130deg, #ffd447 20%, #f7b801 100%);
      opacity: .12;
    }
    /* 品牌logo动画 */
    @keyframes brandPulse {
      0% { box-shadow:0 0 0 0 rgba(36,72,188,0.2);}
      70% { box-shadow:0 0 0 18px rgba(36,72,188,0);}
      100% { box-shadow:0 0 0 0 rgba(36,72,188,0);}
    }
    .header img {
      animation: brandPulse 2.5s infinite;
      border-radius: 12px;
      box-shadow:0 4px 20px rgba(51,70,190,0.10);
    }
  </style>
</head>
<body>
  <!-- 背景装饰 -->
  <div class="bg-circle bg-circle1"></div>
  <div class="bg-circle bg-circle2"></div>
  <div class="header">
    <!-- 换成你自己的logo，或用默认的 -->
    <img src="https://chinacnu.com/favicon.png" alt="CHINACNU STEEL" onerror="this.style.display='none'">
    <h1>阿拉伯语单词学习课堂</h1>
    <div class="sub">CHINACNU STEEL 企业课堂出品</div>
  </div>
  <div class="container">
    <div class="word-card" id="wordCard">
      <div class="welcome-message">
        <p>欢迎进入企业专属课堂，点击下方按钮开始学习阿拉伯语单词！</p>
        <div class="example">
          <div class="word-display">بيت</div>
          <div class="translation">中文: 房子</div>
          <div class="translation">English: house</div>
        </div>
      </div>
    </div>
    <div class="controls">
      <button class="primary-btn" id="nextBtn" onclick="loadWord()">
        <span id="nextBtnText">下一张</span>
      </button>
      <button class="secondary-btn" id="speakBtn" onclick="speakWord()" disabled>
        朗读
      </button>
    </div>
    <div id="errorContainer" class="error-container hidden"></div>
    <div class="stats">
      已学习 <span id="wordCount">0</span> 个单词
    </div>
  </div>
  <script>
    // 自动记忆：用 localStorage 记录已出现单词
    function getHistory() {
      try {
        return JSON.parse(localStorage.getItem('ar_words_history') || '[]');
      } catch {
        return [];
      }
    }
    function saveHistory(arr) {
      localStorage.setItem('ar_words_history', JSON.stringify(arr));
    }
    function resetHistory() {
      localStorage.removeItem('ar_words_history');
    }

    let shownWords = getHistory();
    let currentWord = null;
    let wordCounter = shownWords.length;
    let isLoading = false;
    const wordCard = document.getElementById("wordCard");
    const nextBtn = document.getElementById("nextBtn");
    const speakBtn = document.getElementById("speakBtn");
    const errorContainer = document.getElementById("errorContainer");
    const wordCountElement = document.getElementById("wordCount");
    const nextBtnText = document.getElementById("nextBtnText");

    async function loadWord(attempt = 1) {
      if (isLoading) return;
      isLoading = true;
      nextBtn.disabled = true;
      nextBtnText.innerHTML = `<span class="loading"></span> 加载中`;
      speakBtn.disabled = true;
      hideError();
      wordCard.innerHTML = `
        <div style="text-align: center;">
          <div class="loading" style="margin: 0 auto;"></div>
          <p style="color:#68708c;">正在获取单词...</p>
        </div>
      `;

      try {
        // POST请求，把本地所有已展示过的单词作为 shownWords 传给后端
        const response = await fetch("https://arabic-proxy.head-6c9.workers.dev/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ shownWords })
        });
        if (!response.ok) throw new Error(`请求失败: ${response.status} ${response.statusText}`);
        const data = await response.json();
        if (!data.word) throw new Error("API返回格式有误");

        // 前端本地再去重
        if (shownWords.includes(data.word)) {
          if (attempt < 10) {
            // 再请求一次（防止AI重复，最多尝试10次）
            await loadWord(attempt + 1);
            return;
          } else {
            showError("抱歉，暂时没有新单词可显示！");
            isLoading = false;
            nextBtn.disabled = false;
            nextBtnText.textContent = "下一张";
            return;
          }
        }

        // 新词，保存进本地历史
        shownWords.push(data.word);
        saveHistory(shownWords);
        renderWordCard(data);
        currentWord = data.word;
        wordCounter = shownWords.length;
        wordCountElement.textContent = wordCounter;
        speakBtn.disabled = false;
      } catch (error) {
        showError(error.message);
      } finally {
        isLoading = false;
        nextBtn.disabled = false;
        nextBtnText.textContent = "下一张";
      }
    }

    function renderWordCard(wordData) {
      wordCard.innerHTML = `
        <div class="word-display">${wordData.word}</div>
        <div class="translation">IPA: <span style="font-family:serif;font-size:1.1em">${wordData.ipa||''}</span></div>
        <div class="translation">中文: ${wordData.zh}</div>
        <div class="translation">English: ${wordData.en}</div>
      `;
    }
    function showError(message) {
      errorContainer.innerHTML = `
        <p>❌ ${message}</p>
        <button onclick="loadWord()" class="primary-btn" style="margin-top: 0.5rem;">重试</button>
        <button onclick="resetAll()" class="secondary-btn" style="margin-top: 0.5rem;">重置记忆</button>
      `;
      errorContainer.classList.remove("hidden");
    }
    function hideError() {
      errorContainer.classList.add("hidden");
    }
    function resetAll() {
      resetHistory();
      shownWords = [];
      wordCounter = 0;
      wordCountElement.textContent = "0";
      hideError();
      wordCard.innerHTML = `
        <div class="welcome-message">
          <p>欢迎进入企业专属课堂，点击下方按钮开始学习阿拉伯语单词！</p>
          <div class="example">
            <div class="word-display">بيت</div>
            <div class="translation">中文: 房子</div>
            <div class="translation">English: house</div>
          </div>
        </div>
      `;
    }
    function speakWord() {
      if (!currentWord) return;
      try {
        if (!window.speechSynthesis) throw new Error("您的浏览器不支持语音合成");
        const utterance = new SpeechSynthesisUtterance(currentWord);
        utterance.lang = 'ar-SA';
        utterance.rate = 0.8;
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utterance);
      } catch (error) {
        showError(`朗读失败: ${error.message}`);
      }
    }
    document.addEventListener('DOMContentLoaded', () => {
      if (!window.speechSynthesis) speakBtn.style.display = 'none';
      wordCountElement.textContent = wordCounter;
    });
  </script>
</body>
</html>

